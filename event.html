<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ì´ë²¤íŠ¸ í˜ì´ì§€</title>
<style>
  body {
    font-family: "Malgun Gothic", sans-serif;
    background-color: #f2f5f8;
    margin: 0;
    padding: 0;
    font-size: 14px;
  }
  .chat-container {
    width: 100%;
    max-width: 500px;
    box-sizing: border-box;
    height: 600px;
    overflow-y: auto;
    margin: 40px auto 10px;
    padding: 10px;
    background-color: #e0f3ff;
    border-radius: 15px;
    padding-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
  .chat-card {
    max-width: 100%;
    padding: 16px;
    margin: 20px auto;
    border-radius: 12px;
    background-color: #ffffff;
    border: 1px solid #ccc;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-size: 14px;
    line-height: 1.6;
    word-wrap: break-word;
    box-sizing: border-box;
    text-align: left;
    position: relative;
  }
  .card-footer {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-top: 10px;
    gap: 12px;
  }
  .timestamp {
    font-size: 12px;
    color: #888;
  }
  .input-container {
    max-width: 500px;
    margin: 10px auto;
    display: flex;
    gap: 8px;
    padding: 0 10px;
  }
  #chatInput {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  #sendBtn {
    padding: 10px 16px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #sendBtn:hover {
    background-color: #0056b3;
  }
  #adminBtn {
    display: block;
    margin: 0 auto 20px;
    background-color: #333;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 14px;
  }
  .delete-button {
    background-color: #999;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 4px 10px;
    font-size: 13px;
    cursor: pointer;
    position: absolute;
    top: 10px;
    right: 10px;
  }
  .like-button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
  }
  .like-button.liked {
    color: #007bff;
  }
  .like-count {
    font-size: 14px;
    color: #333;
    margin-left: 4px;
  }
</style>
</head>
<body>


<div style="max-width: 500px; margin: 20px auto 0; padding: 0 10px; font-size: 17px; font-weight: bold; color: #000000; text-align: center;">
1. ë‹¤ìŒ ì—¬ì„±ì‹œëŒ€ <span style="color: red;">ì €ê²©/ë¶€ì •ì  ì–¸ê¸‰ ê¸ˆì§€</span></br></br>
2. ì „ìƒë‹¬ê¸€ ì–¸ê¸‰ ê¸ˆì§€</br></br>
3. ë‚˜ëˆ”ë°›ì€ ë¬¼í’ˆ ìƒì„¸ ì–¸ê¸‰ ê¸ˆì§€</br>
<small style="color: #888888;">ex. ë‚˜ëˆ”ë°›ì€ ìŒì‹ ë¨¹ìœ¼ë©° ë²„í‹¸ ìˆ˜ ìˆì—ˆë‹¤. â­•</br>
ë‚˜ëˆ”ë°›ì€ ê¹€ë°¥ ë¨¹ìœ¼ë©° ë²„í‹¸ ìˆ˜ ìˆì—ˆë‹¤. âŒ</small>
</br></br>
ğŸ§¨ê³µì§€ ì–´ê¸´ ê¸€ì€ ë¬´í†µë³´ ì‚­ì œí•©ë‹ˆë‹¤.ğŸ§¨
</div>
<div class="chat-container" id="chatBox"></div>

<div class="input-container">
  <input type="text" id="chatInput" placeholder="ë“±ë¡ í›„ ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€. ê³µì§€ ì–´ê¸´ ê¸€ì€ ë‹¬ì£¼ê°€ ë¬´í†µë³´ ì‚­ì œ."/>
  <button id="sendBtn">ë“±ë¡</button>
</div>

<button id="adminBtn">ğŸ”’ ë‹¬ì£¼ ì „ìš©</button>







<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  addDoc,
  deleteDoc,
  doc,
  getDoc,
  updateDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAZHqkGXdH4XxL-0jprA2DB7YO4XhTdNmQ",
  authDomain: "chat-page-6d547.firebaseapp.com",
  projectId: "chat-page-6d547",
  storageBucket: "chat-page-6d547.appspot.com",
  messagingSenderId: "1087235341754",
  appId: "1:1087235341754:web:6583340a62f21068b5b183"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let isAdmin = false;

document.getElementById("sendBtn").onclick = async () => {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;

  // ë‹‰ë„¤ì„ ìë™ ë¶€ì—¬
  const counterRef = doc(db, "meta", "nicknameCounter");
  const counterSnap = await getDoc(counterRef);
  let nickname = "ìµëª… ?";
  if (counterSnap.exists()) {
    const count = counterSnap.data().count || 1;
    nickname = `ìµëª… ${count}`;
    await updateDoc(counterRef, { count: count + 1 });  // ë‹¤ìŒ ë²ˆí˜¸ë¡œ ì¦ê°€
  }

  await addDoc(collection(db, "chat"), {
    text,
    timestamp: serverTimestamp(),
    likes: 0,
    nickname
  });
  input.value = "";
  loadChat();
};

async function loadChat() {
  const box = document.getElementById("chatBox");
  box.innerHTML = "";
  const snapshot = await getDocs(collection(db, "chat"));
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const id = docSnap.id;
    const key = `liked_${id}`;
    const liked = localStorage.getItem(key) === "true";

    const div = document.createElement("div");
    div.className = "chat-card";



div.innerHTML = `
  ${isAdmin ? `<button class="delete-button" onclick="deleteChat('${id}')">ì‚­ì œ</button>` : ""}
  <div><strong>${data.nickname || "ìµëª…"}</strong></div>
  <div>${data.text}</div>
  <div class="card-footer">
        <button class="like-button ${liked ? "liked" : ""}" onclick="likeChat('${id}', this)">${liked ? "ğŸ’™" : "â™¡"}</button>
        <span class="like-count">${data.likes || 0}</span>
        <div class="timestamp">${data.timestamp && data.timestamp.toDate ? (() => {
  const date = new Date(data.timestamp.toDate());
  return date.toLocaleString("ko-KR", {
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit"
  });
})() : ""}</div>
      </div>
    `;
    box.appendChild(div);
  });
  box.scrollTop = box.scrollHeight;
}

window.deleteChat = async function(id) {
  const ok = confirm("ì‚­ì œí• ê¹Œìš”?");
  if (!ok) return;
  await deleteDoc(doc(db, "chat", id));
  loadChat();
};

window.likeChat = async function(id, btn) {
  const key = `liked_${id}`;
  const ref = doc(db, "chat", id);
  const snap = await getDoc(ref);
  if (!snap.exists()) return;
  const data = snap.data();
  const countSpan = btn.nextElementSibling;
  let currentLikes = data.likes || 0;

  const liked = localStorage.getItem(key) === "true";
  if (liked) {
    await updateDoc(ref, { likes: currentLikes - 1 });
    localStorage.setItem(key, "false");
    btn.classList.remove("liked");
    btn.innerHTML = "â™¡";
    countSpan.textContent = currentLikes - 1;
  } else {
    await updateDoc(ref, { likes: currentLikes + 1 });
    localStorage.setItem(key, "true");
    btn.classList.add("liked");
    btn.innerHTML = "ğŸ’™";
    countSpan.textContent = currentLikes + 1;
  }
};

document.getElementById("adminBtn").onclick = async () => {
  const pwd = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
  if (!pwd) return;
  const snap = await getDoc(doc(db, "admin", "secret"));
  if (!snap.exists()) return alert("ë¹„ë°€ë²ˆí˜¸ ë°ì´í„° ì—†ìŒ");
  const real = snap.data().password;
  if (pwd === real) {
    isAdmin = true;
    loadChat();
    alert("ê´€ë¦¬ì ê¶Œí•œì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
  } else {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
  }
};

loadChat();
</script>





</body>
</html>
