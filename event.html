<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>이벤트 페이지</title>
<style>
  body {
    font-family: "Malgun Gothic", sans-serif;
    background-color: #f2f5f8;
    margin: 0;
    padding: 0;
    font-size: 14px;
  }
  .chat-container {
    width: 100%;
    max-width: 500px;
    box-sizing: border-box;
    height: 600px;
    overflow-y: auto;
    margin: 40px auto 10px;
    padding: 10px;
    background-color: #e0f3ff;
    border-radius: 15px;
    padding-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
  .chat-card {
    max-width: 100%;
    padding: 16px;
    margin: 20px auto;
    border-radius: 12px;
    background-color: #ffffff;
    border: 1px solid #ccc;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-size: 14px;
    line-height: 1.6;
    word-wrap: break-word;
    box-sizing: border-box;
    text-align: left;
    position: relative;
  }
  .timestamp {
    font-size: 12px;
    color: #888;
    text-align: right;
    margin-top: 8px;
  }
  .input-container {
    max-width: 500px;
    margin: 10px auto;
    display: flex;
    gap: 8px;
    padding: 0 10px;
  }
  #chatInput {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  #sendBtn {
    padding: 10px 16px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #sendBtn:hover {
    background-color: #0056b3;
  }
  #adminBtn {
    display: block;
    margin: 0 auto 20px;
    background-color: #333;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 14px;
  }
</style>
</head>
<body>
<div class="chat-container" id="chatBox"></div>

<div class="input-container">
  <input type="text" id="chatInput" placeholder="메시지를 입력하세요"/>
  <button id="sendBtn">보내기</button>
</div>

<button id="adminBtn">🔒 관리자 전용</button>

<!-- ✅ Firebase 연동 및 관리자 기능 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  addDoc,
  deleteDoc,
  doc,
  getDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAZHqkGXdH4XxL-0jprA2DB7YO4XhTdNmQ",
  authDomain: "chat-page-6d547.firebaseapp.com",
  projectId: "chat-page-6d547",
  storageBucket: "chat-page-6d547.appspot.com",
  messagingSenderId: "1087235341754",
  appId: "1:1087235341754:web:6583340a62f21068b5b183"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let isAdmin = false;

document.getElementById("sendBtn").onclick = async () => {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;

  await addDoc(collection(db, "chat"), {
    text,
    timestamp: serverTimestamp()
  });
  input.value = "";
  loadChat();
};

async function loadChat() {
  const box = document.getElementById("chatBox");
  box.innerHTML = "";
  const snapshot = await getDocs(collection(db, "chat"));
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "chat-card";
    div.innerHTML = `
      <div>${data.text}</div>
      <div class="timestamp">${data.timestamp && data.timestamp.toDate ? new Date(data.timestamp.toDate()).toLocaleString("ko-KR") : ""}</div>
      ${isAdmin ? `<button onclick="deleteChat('${docSnap.id}')">삭제</button>` : ""}
    `;
    box.appendChild(div);
  });
  box.scrollTop = box.scrollHeight;
}

window.deleteChat = async function(id) {
  const ok = confirm("삭제할까요?");
  if (!ok) return;
  await deleteDoc(doc(db, "chat", id));
  loadChat();
};

document.getElementById("adminBtn").onclick = async () => {
  const pwd = prompt("비밀번호를 입력하세요");
  if (!pwd) return;
  const snap = await getDoc(doc(db, "admin", "secret"));
  if (!snap.exists()) return alert("비밀번호 데이터 없음");
  const real = snap.data().password;
  if (pwd === real) {
    isAdmin = true;
    loadChat();
    alert("관리자 권한이 활성화되었습니다.");
  } else {
    alert("비밀번호가 틀렸습니다.");
  }
};

loadChat();
</script>
</body>
</html>
