
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>오늘의 메시지</title>
<style>
  body {
    font-family: "Malgun Gothic", sans-serif;
    background-color: #f2f5f8;
    margin: 0;
    padding: 0;
    font-size: 14px;
  }
.chat-text.preview {
  max-height: 7.3em;
  overflow: hidden;
}
.chat-text.expanded {
  max-height: none;
}
#infoBtn {
  display: block;
  margin: 0 auto 20px;
  background-color: #333;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
  font-size: 14px;
}

.toggle-more {
  text-align: right;
  font-size: 12px;
  color: gray;
  cursor: pointer;
  margin-top: 6px;
}
  .chat-container {
    width: 100%;
    max-width: 500px;
    box-sizing: border-box;
    height: 90vh;
    overflow-y: auto;
    margin: 40px auto 10px;
    padding: 10px;
    background-color: #e0f3ff;
    border-radius: 15px;
    padding-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
#editInput {
  width: 100%;
  display: none;
  padding: 10px;
  font-size: 14px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: 'Malgun Gothic', sans-serif;
  box-sizing: border-box;
  resize: none;
  overflow: hidden;
  min-height: 38px;
}

  .chat-card {
    max-width: 100%;
    padding: 16px;
    margin: 20px auto;
    border-radius: 12px;
    border: 1px solid #ccc;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-size: 14px;
    line-height: 1.6;
    word-wrap: break-word;
    box-sizing: border-box;
    text-align: left;
    position: relative;
  }
.card-footer {
  display: flex;
  justify-content: space-between; /* 양쪽 정렬로 바꿈 */
  align-items: center;
  margin-top: 10px;
}

  .timestamp {
    font-size: 12px;
    color: #888;
  }
  .input-container {
    max-width: 500px;
    margin: 10px auto;
    display: flex;
    gap: 8px;
    padding: 0 10px;
  }
#chatInput {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  font-family: 'Malgun Gothic', sans-serif;
  resize: none;
  overflow: hidden;
  box-sizing: border-box;
  min-height: 38px;
  /* flex: 1; ← 이 줄 제거! */
}


  #sendBtn {
    padding: 10px 16px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #sendBtn:hover {
    background-color: #0056b3;
  }
  #adminBtn {
    display: block;
    margin: 0 auto 20px;
    background-color: #333;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 14px;
  }
.admin-button {
  background-color: #999;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 4px 10px;
  font-size: 13px;
  cursor: pointer;
  margin-left: 6px;
}

  .like-button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
  }
  .like-button.liked {
    color: #007bff;
  }
  .like-count {
    font-size: 14px;
    color: #333;
    margin-left: 4px;
  }

.pinned-card {
  position: sticky;
  top: 0;
  z-index: 9999; /* 가장 위로 올리기 */
  background-color: #fff8dc;
  border: 2px solid #ff8c00;
}
/* 반짝 효과 */
@keyframes sparkle {
  0%   { opacity: 1; text-shadow: 0 0 5px #3399ff; }
  50%  { opacity: 0.6; text-shadow: 0 0 12px #66ccff; }
  100% { opacity: 1; text-shadow: 0 0 5px #3399ff; }
}
.sparkling-text {
  animation: sparkle 1.5s infinite;
  font-weight: bold;
  color: #007bff;
}
.question-chip {
  display: inline-block;
  margin: 6px 0 8px;
  padding: 4px 8px;
  font-size: 12px;
  color: #333;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 999px;
  line-height: 1;
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

</style>
</head>
<body>

<div style="max-width: 500px; margin: 20px auto 0; padding: 0 10px; font-size: 17px; font-weight: bold; color: #000000; text-align: center;">


<div id="daily-topic" ...>
  <span id="topic-text" class="sparkling-text">(불러오는 중…)</span>
</div>


<div class="chat-container" id="chatBox"></div>


<div class="input-container" style="flex-direction: column; gap: 10px;">
  <!-- 등록용 -->
  <textarea id="chatInput"
    rows="1"
    placeholder="등록 후 수정/삭제 불가. 공지 어긴 글은 달주가 무통보 삭제."
    style="width: 100%; padding: 10px; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Malgun Gothic', sans-serif; box-sizing: border-box; resize: none; overflow: hidden;"></textarea>
  <button id="sendBtn" style="align-self: flex-end;">등록</button>

  <!-- ✏️ 수정용 입력창도 같이 넣기 -->
  <textarea id="editInput"
    placeholder="수정할 내용을 입력하세요"
    rows="4"
    style="width: 100%; display: none; padding: 10px; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Malgun Gothic', sans-serif; box-sizing: border-box; resize: none; overflow: hidden;"></textarea>
  <button id="editSubmitBtn"
    style="display: none; align-self: flex-end; padding: 10px 16px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;">수정 완료</button>
</div>





<div id="topButtons" style="display:flex; justify-content:center; gap:8px;">
  <button id="infoBtn">ℹ️ 정보 달글 이동</button>
  <button id="adminBtn">🔒 달주 전용</button>
</div>


<div id="status-bar" style="display:flex; justify-content:center; gap:20px; font-size:13px; color:#555; margin-top:12px;">
  <div id="upload-count">오늘의 답변 수를 불러오는 중...</div>
  <div id="visit-count">방문자 수를 불러오는 중...</div>
</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
  getFirestore,
  collection,
  getDocs,
  addDoc,
  deleteDoc,
  doc,
  getDoc,
  updateDoc,
  serverTimestamp,
  setDoc,
  query,
  where              // ✅ 추가
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
/* ===== 오늘의 주제 자동 변경 ===== */
/* ===== 오늘의 주제 자동 변경 ===== */
const TOPIC_LIST = [
  '아스팔트로 나왔던 나날 중, 마음을 가장 크게 흔든 순간이 있었나요?',
  '힘들었지만, 그래도 "이건 내가 진짜 자랑스러웠다" 싶었던 기억이 있었나요?',
  '함께 구호를 외치면서 가장 크게 용기를 얻었던 순간은 언제였나요?',
  '추위 속에서도 "이 것 때문에 버틸 수 있다."는 느낌을 주었던 무언가가 있었나요?',
  '집회에서 만난 분들 중에 아직도 마음에 남는 얼굴이 있으신가요? (전생 달글 언급 유의)',
  '나 혼자가 아니구나" 하고 느꼈던 순간은 언제였나요?',
  '두려움 속에서도 웃음이 터졌던, 예상치 못한 순간이 있으셨나요?',
  '힘들 때 마음을 지탱해 준 노래나 구호가 있으셨나요? 있었다면 어느 가사/구호인가요?',
  '계엄 소식을 처음 들었을 때, 가장 먼저 떠오른 생각은 뭐였나요?',
  '이건 꼭 기록해둬야겠다"라고 마음먹었던 순간이 있었나요?',
  '깃발/응원봉 등을 붙잡고 섰을 때, 가장 먼저 힘들었던 부분은 어디였나요?',
  '길에서 만난 낯선 사람이 해준 말 중 아직도 기억나는 게 있으신가요?',
  '가장 두려웠던 순간, 어떻게 버티셨는지 떠올려 보실 수 있나요?',
  '집회 끝나고 돌아오는 길, 하늘이나 바람이 다르게 느껴진 적 있으신가요?',
  '누군가의 눈물을 보면서 같이 마음이 무너졌던 순간이 있었나요?',
  '이 싸움은 내가 살아 있다는 증거다"라고 느꼈던 날은 언제였나요?',
  '스스로에게 했던 말 중에 가장 힘이 되었던 말은 뭐였나요?',
  '피곤해도 계속 나오게 만든 이유, 지금 생각하면 뭐였던 것 같나요?',
  '무서워서 발걸음이 멈출 뻔했는데도 결국 나서게 한 힘은 뭐였나요?',
  '그때 배운 작은 생활 지혜(옷, 음식, 추위를 견디는 방법 등) 중에 지금도 쓰는 게 있으신가요? (전생 달글 언급 유의)',
  '분노 대신 차분함을 선택했던 순간이 있으셨나요? 어떻게 하셨나요?',
  '술자리나 밥자리에서 집회 얘기를 꺼냈을 때, 의외로 공감해준 사람이 있었나요?',
  '내가 살아 있다는 것 자체가 증거다"라고 느낀 순간은 언제였나요?',
  '가장 몸이 힘들었는데도 끝까지 버틴 하루는 언제였나요?',
  '집에 돌아와 혼자 눈물을 흘렸던 기억이 있다면, 어떤 생각 때문이었나요?',
  '불확실한 내일 속에서도 "내가 할 수 있는 건 있다"라고 다짐했던 건 뭐였나요?',
  '누군가 건넨 따뜻한 음식이나 물 한 병이 유난히 고마웠던 날 기억나시나요?',
  'SNS나 메시지로 받은 응원 중에 지금도 기억나는 말씀이 있으신가요?',
  '우리는 이겼다"라고 느낀 작은 순간이 있었나요?',
  '지금 돌아보면, 그때의 나에게 해주고 싶은 한마디가 있을까요?',
  '불법 계엄 이전/이후 나의 가장 달라진 모습은 무엇일까요?',
  '최근 보신 뉴스/영상 중에서 가장 "희망적"이라고 느끼신 장면은 무엇이었나요?',
  '과거를 돌아볼 때, 우리가 함께 이겨낸 순간 중 가장 기억에 남는 건 언제인가요?',
  '오늘의 시사 주제에서 "앞으로 더 나아질 수 있겠다"는 가능성을 느끼신 부분은 어디였나요?',
  '최근 정치·사회 변화 속에서 개인적으로 가장 힘이 되었던 기억은 무엇이었나요?',
  '영상을 보면서 "이런 노력은 내가 직접 해보고 싶다"고 느끼신 게 있으셨나요?',
  '뉴스 속 장면 중, 함께해서 더 강해진 경험을 떠올리게 한 건 어떤 부분이었나요?',
  '이건 우리 세대가 반드시 해내야 한다"는 생각이 들었던 부분이 있을까요?',
  '앞으로 더 나은 사회를 위해 내가 작게라도 실천할 수 있는 건 무엇일까요?',
  '최근 시사 이슈에서 가장 "긍정적인 변화의 씨앗"이라고 느끼신 건 무엇인가요?',
  '지난 집회·토론·현장 경험 중에서 지금 떠올리면 용기가 나는 순간은 언제인가요?',
  '영상을 보며 "이건 우리가 반드시 지켜야 한다"고 다짐한 가치가 있으신가요?',
  '오늘 주제에서 "내가 할 수 있는 몫"을 다시 생각하게 된 부분은 어디였나요?',
  '정치·사회 현안 속에서 "작은 목소리라도 힘이 된다"는 걸 느끼신 경험이 있으신가요?',
  '다큐나 뉴스를 보며 "그래도 변화를 만들 수 있다"는 희망을 얻은 부분은 무엇이었나요?',
  '예전에 힘들었지만, 결국 우리가 이겨냈다고 느꼈던 기억은 어떤 건가요?',
  '영상을 보면서 "지금보다 더 나은 내일"을 상상하게 만든 부분은 어디였나요?',
  '오늘 다룬 주제 중 "다음 세대에게 꼭 물려주고 싶은 가치"는 무엇이었나요?',
  '우리가 함께 목소리를 낼 때, 세상이 바뀐 경험을 떠올리신 적 있으신가요?',
  '이번 이슈를 보며 "나는 절대 포기하지 않겠다"는 생각을 굳히신 부분은 무엇이었나요?',
  '정치·사회 흐름 속에서 "내가 이 길을 계속 가야 한다"고 다짐하게 된 순간은 언제였나요?',
  '뉴스 속에서 보신 인물 중 "이런 자세는 본받고 싶다"고 느끼신 분이 있으신가요?',
  '영상을 보며 "그래, 결국 역사는 앞으로 나아간다"고 확신하게 된 이유는 무엇이었나요?',
  '오늘 주제 중 "우리가 함께라서 가능하다"고 느낀 부분은 어디였나요?',
  '예전의 절망적인 순간을 돌이켜보면, "그때 내가 버텨서 다행이다" 싶은 경험은 무엇인가요?',
  '이번 주제에서 "앞으로의 나"에게 해주고 싶은 다짐은 어떤 건가요?',
  '영상을 보며 떠오른 "내가 지키고 싶은 한국 사회의 모습"은 무엇이었나요?',
  '뉴스 속에서 발견한 "작은 희망의 징후"는 무엇이었나요?',
  '오늘 주제에서 느낀 "우리는 반드시 해낼 수 있다"는 확신의 근거는 무엇이었나요?',
  '지금 돌아보면, "앞으로의 길에서 나 자신에게 해주고 싶은 격려의 말"은 무엇인가요?'
];


// 방문 중 고정 랜덤 토픽 선택
function getSessionTopic() {
  const key = "session_topic";
  const saved = sessionStorage.getItem(key);
  if (saved) return saved;
  
  const i = Math.floor(Math.random() * TOPIC_LIST.length);
  const newTopic = TOPIC_LIST[i];
  sessionStorage.setItem(key, newTopic);
  return newTopic;
}

// 선택된 토픽을 화면에 렌더링
function renderTodayTopic() {
  const el = document.getElementById("topic-text");
  if (!el) return;
  el.textContent = getSessionTopic();
}

renderTodayTopic();


const firebaseConfig = {
  apiKey: "AIzaSyAZHqkGXdH4XxL-0jprA2DB7YO4XhTdNmQ",
  authDomain: "chat-page-6d547.firebaseapp.com",
  projectId: "chat-page-6d547",
  storageBucket: "chat-page-6d547.appspot.com",
  messagingSenderId: "1087235341754",
  appId: "1:1087235341754:web:6583340a62f21068b5b183"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let isAdmin = false;
let editingId = null;

const pastelColors = ['#fff5f7', '#fffdea', '#f0fbff', '#f0fff4', '#f7f3ff', '#fffaf0', '#fef4fb'];





document.getElementById("sendBtn").onclick = async () => {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;

  // ▼ 현재 화면에 보이는 상단 질문 텍스트
  const topicText = (document.getElementById("topic-text")?.textContent || "").trim();

  const counterRef = doc(db, "meta", "nicknameCounter");
  const counterSnap = await getDoc(counterRef);
  let nickname = "익명 ?";
  if (counterSnap.exists()) {
    const count = counterSnap.data().count || 1;
    nickname = `익명 ${count}`;
    await updateDoc(counterRef, { count: count + 1 });
  }

  await addDoc(collection(db, "chat"), {
    text,
    question: topicText,  // ← 질문 함께 저장
    timestamp: serverTimestamp(),
    likes: 0,
    nickname
  });

  input.value = "";
  loadChat();
};




document.getElementById("editSubmitBtn").onclick = async () => {
  const text = document.getElementById("editInput").value.trim();
  if (!text || !editingId) return;
  const ref = doc(db, "chat", editingId);
  await updateDoc(ref, { text });
  editingId = null;
  document.getElementById("editInput").style.display = "none";
  document.getElementById("editSubmitBtn").style.display = "none";
  document.getElementById("editInput").value = "";
  loadChat();
};





async function loadChat() {
  const box = document.getElementById("chatBox");
  box.innerHTML = "";
  const snapshot = await getDocs(collection(db, "chat"));
  let lastColorIndex = -1;

  const chats = [];
  snapshot.forEach(docSnap => {
    chats.push({ id: docSnap.id, ...docSnap.data() });
  });

  chats.sort((a, b) => {
    if (a.pinned && !b.pinned) return -1;
    if (!a.pinned && b.pinned) return 1;
    return (a.timestamp?.seconds || 0) - (b.timestamp?.seconds || 0);
  });

  for (const data of chats) {
    const id = data.id;
    const key = `liked_${id}`;
    const liked = localStorage.getItem(key) === "true";

    let colorIndex;
    do {
      colorIndex = Math.floor(Math.random() * pastelColors.length);
    } while (colorIndex === lastColorIndex);
    lastColorIndex = colorIndex;
    const cardColor = pastelColors[colorIndex];

    const div = document.createElement("div");
    div.className = "chat-card";
    if (data.pinned === true) div.classList.add("pinned-card");
    div.style.backgroundColor = cardColor;

    // 🔒 관리자 버튼 영역
    if (isAdmin) {
      const adminControls = document.createElement("div");
      adminControls.style.display = "flex";
      adminControls.style.justifyContent = "flex-end";
      adminControls.style.gap = "6px";
      adminControls.style.marginBottom = "8px";

      const pinBtn = document.createElement("button");
      pinBtn.className = "admin-button";
      pinBtn.textContent = data.pinned ? "고정 해제" : "고정";
      pinBtn.onclick = () => togglePin(id, !!data.pinned);

      const editBtn = document.createElement("button");
      editBtn.className = "admin-button";
      editBtn.textContent = "수정";
      editBtn.onclick = () => editChat(id, data.text.replace(/`/g, "\\`"));

      const delBtn = document.createElement("button");
      delBtn.className = "admin-button";
      delBtn.textContent = "삭제";
      delBtn.onclick = () => deleteChat(id);

      adminControls.appendChild(pinBtn);
      adminControls.appendChild(editBtn);
      adminControls.appendChild(delBtn);
      div.appendChild(adminControls);
    }





    // 닉네임/고정 마크
    const header = document.createElement("div");
    header.innerHTML = `<strong>${data.pinned ? "📌" : (data.nickname || "익명")}</strong>`;
    div.appendChild(header);
// ▼ 질문 배지


// ▼ 질문 배지 (고정글에는 표시 안 함)
if (!data.pinned) {
  const q = document.createElement("div");
  q.className = "question-chip";
  const qText = (data.question && String(data.question).trim()) || "질문 미기록";
  q.textContent = `Q. ${qText}`;
  div.appendChild(q);
}




    // 본문 영역 (더보기/줄이기 포함)
    const textDiv = document.createElement("div");




    textDiv.className = "chat-text preview";
    textDiv.innerHTML = (data.text || "")
      .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
      .replace(/~~(.+?)~~/g, '<span style="font-size: 12px; color: #888;">$1</span>')
      .replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank">$1</a>')
      .replace(/\n/g, "<br>");

    const toggle = document.createElement("div");
    toggle.className = "toggle-more";
    toggle.textContent = "더보기";
    toggle.addEventListener("click", (e) => {
      e.stopPropagation();
      textDiv.classList.toggle("expanded");
      textDiv.classList.toggle("preview");
      toggle.textContent = textDiv.classList.contains("expanded") ? "줄이기" : "더보기";
    });

    div.appendChild(textDiv);

    requestAnimationFrame(() => {
      if (textDiv.scrollHeight > textDiv.clientHeight + 4) {
        div.appendChild(toggle);
      }
    });

    // 하단 좋아요/시간 표시
    const footer = document.createElement("div");
    footer.className = "card-footer";
    footer.innerHTML = `
      <div style="display: flex; align-items: center; gap: 4px;">
        <button class="like-button ${liked ? "liked" : ""}" onclick="likeChat('${id}', this)">
          ${liked ? "💙" : "♡"}
        </button>
        <span class="like-count">${data.likes || 0}</span>
      </div>
      <div class="timestamp">${data.timestamp?.toDate ? new Date(data.timestamp.toDate()).toLocaleString("ko-KR", {
        year: "numeric", month: "2-digit", day: "2-digit",
        hour: "2-digit", minute: "2-digit"
      }) : ""}</div>
    `;

    div.appendChild(footer);
    box.appendChild(div);
  }

  box.scrollTop = box.scrollHeight;
}







window.deleteChat = async function(id) {
  const ok = confirm("삭제할까요?");
  if (!ok) return;
  await deleteDoc(doc(db, "chat", id));
  loadChat();
};
window.togglePin = async function(id, currentlyPinned) {
  const ref = doc(db, "chat", id);
  await updateDoc(ref, { pinned: !currentlyPinned });
  loadChat();
};

window.likeChat = async function(id, btn) {
  const key = `liked_${id}`;
  const ref = doc(db, "chat", id);
  const snap = await getDoc(ref);
  if (!snap.exists()) return;
  const data = snap.data();
  const countSpan = btn.nextElementSibling;
  let currentLikes = data.likes || 0;

  const liked = localStorage.getItem(key) === "true";
  if (liked) {
    await updateDoc(ref, { likes: currentLikes - 1 });


    localStorage.setItem(key, "false");
    btn.classList.remove("liked");
    btn.innerHTML = "♡";
    countSpan.textContent = currentLikes - 1;
  } else {
    await updateDoc(ref, { likes: currentLikes + 1 });

    btn.classList.add("liked");
    btn.innerHTML = "💙";
    countSpan.textContent = currentLikes + 1;
  }
};
window.editChat = function(id, currentText) {
  const editBox = document.getElementById("editInput");
  const editBtn = document.getElementById("editSubmitBtn");
  editingId = id;
  editBox.value = currentText;
  editBox.style.display = "block";
  editBtn.style.display = "inline-block";
};


document.getElementById("infoBtn").onclick = () => {
  window.location.href = "https://www.yssisa.store";
};

document.getElementById("adminBtn").onclick = async () => {
  const pwd = prompt("비밀번호를 입력하세요");
  if (!pwd) return;
  const snap = await getDoc(doc(db, "admin", "secret"));
  if (!snap.exists()) return alert("비밀번호 데이터 없음");
  const real = snap.data().password;
  if (pwd === real) {
    isAdmin = true;
    loadChat();
    alert("관리자 권한이 활성화되었습니다.");
  } else {
    alert("비밀번호가 틀렸습니다.");
  }
};

loadChat();
const chatInput = document.getElementById("chatInput");

chatInput.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});
const editInput = document.getElementById("editInput");
editInput.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});








function getKSTDateKey() {
  const now = new Date();
  const kstOffset = 9 * 60 * 60 * 1000;
  const kstNow = new Date(now.getTime() + kstOffset);
  return kstNow.toISOString().split('T')[0];
}

async function countVisitor() {
  const dateKey = getKSTDateKey();
  const pageKey = dateKey + "_event"; // ✅ 페이지 구분 추가
  const visited = localStorage.getItem('visited_' + pageKey);
  if (visited) {
    getVisitorCount(pageKey);
    return;
  }

  const counterRef = doc(db, "visit_count", pageKey);  // ✅ 문서 ID에 _event
  const snap = await getDoc(counterRef);
  if (snap.exists()) {
    const current = snap.data().total || 0;
    await setDoc(counterRef, { total: current + 1 });
    displayVisitorCount(current + 1);
  } else {
    await setDoc(counterRef, { total: 1 });
    displayVisitorCount(1);
  }







 localStorage.setItem('visited_' + pageKey, 'true');
}

async function getVisitorCount(todayKey) {
  const counterRef = doc(db, "visit_count", todayKey);
  const snap = await getDoc(counterRef);
  if (snap.exists()) {
    const current = snap.data().total || 0;
    displayVisitorCount(current);
  } else {
    displayVisitorCount(0);
  }
}

function displayVisitorCount(count) {
  const visitDiv = document.getElementById("visit-count");
  if (visitDiv) {
    visitDiv.textContent = `오늘 방문자 수: ${count.toLocaleString()}명`;
  }
}


async function countTodayUploadRequests() {
  const todayKey = getKSTDateKey();
  const start = new Date(`${todayKey}T00:00:00+09:00`);
  const end = new Date(`${todayKey}T23:59:59+09:00`);

  // chat 컬렉션에서 오늘 글만 조회
  const q = query(
    collection(db, "chat"),
    where("timestamp", ">=", start),
    where("timestamp", "<=", end)
  );

  const snapshot = await getDocs(q);
  const count = snapshot.size;

  const countDiv = document.getElementById("upload-count");
  if (countDiv) {
    countDiv.textContent = `오늘 채팅 수: ${count.toLocaleString()}건`;
  }
}



countVisitor();
countTodayUploadRequests();




</script>
</body>
</html>
