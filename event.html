
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€</title>
<style>
  body {
    font-family: "Malgun Gothic", sans-serif;
    background-color: #f2f5f8;
    margin: 0;
    padding: 0;
    font-size: 14px;
  }
.chat-text.preview {
  max-height: 7.3em;
  overflow: hidden;
}
.chat-text.expanded {
  max-height: none;
}
#infoBtn {
  display: block;
  margin: 0 auto 20px;
  background-color: #333;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
  font-size: 14px;
}

.toggle-more {
  text-align: right;
  font-size: 12px;
  color: gray;
  cursor: pointer;
  margin-top: 6px;
}
  .chat-container {
    width: 100%;
    max-width: 500px;
    box-sizing: border-box;
    height: 90vh;
    overflow-y: auto;
    margin: 40px auto 10px;
    padding: 10px;
    background-color: #e0f3ff;
    border-radius: 15px;
    padding-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
#editInput {
  width: 100%;
  display: none;
  padding: 10px;
  font-size: 14px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: 'Malgun Gothic', sans-serif;
  box-sizing: border-box;
  resize: none;
  overflow: hidden;
  min-height: 38px;
}

  .chat-card {
    max-width: 100%;
    padding: 16px;
    margin: 20px auto;
    border-radius: 12px;
    border: 1px solid #ccc;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-size: 14px;
    line-height: 1.6;
    word-wrap: break-word;
    box-sizing: border-box;
    text-align: left;
    position: relative;
  }
.card-footer {
  display: flex;
  justify-content: space-between; /* ì–‘ìª½ ì •ë ¬ë¡œ ë°”ê¿ˆ */
  align-items: center;
  margin-top: 10px;
}

  .timestamp {
    font-size: 12px;
    color: #888;
  }
  .input-container {
    max-width: 500px;
    margin: 10px auto;
    display: flex;
    gap: 8px;
    padding: 0 10px;
  }
#chatInput {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  font-family: 'Malgun Gothic', sans-serif;
  resize: none;
  overflow: hidden;
  box-sizing: border-box;
  min-height: 38px;
  /* flex: 1; â† ì´ ì¤„ ì œê±°! */
}


  #sendBtn {
    padding: 10px 16px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #sendBtn:hover {
    background-color: #0056b3;
  }
  #adminBtn {
    display: block;
    margin: 0 auto 20px;
    background-color: #333;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    font-size: 14px;
  }
.admin-button {
  background-color: #999;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 4px 10px;
  font-size: 13px;
  cursor: pointer;
  margin-left: 6px;
}

  .like-button {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 18px;
  }
  .like-button.liked {
    color: #007bff;
  }
  .like-count {
    font-size: 14px;
    color: #333;
    margin-left: 4px;
  }

.pinned-card {
  position: sticky;
  top: 0;
  z-index: 9999; /* ê°€ì¥ ìœ„ë¡œ ì˜¬ë¦¬ê¸° */
  background-color: #fff8dc;
  border: 2px solid #ff8c00;
}
/* ë°˜ì§ íš¨ê³¼ */
@keyframes sparkle {
  0%   { opacity: 1; text-shadow: 0 0 5px #3399ff; }
  50%  { opacity: 0.6; text-shadow: 0 0 12px #66ccff; }
  100% { opacity: 1; text-shadow: 0 0 5px #3399ff; }
}
.sparkling-text {
  animation: sparkle 1.5s infinite;
  font-weight: bold;
  color: #007bff;
}
.question-chip {
  display: inline-block;
  margin: 6px 0 8px;
  padding: 4px 8px;
  font-size: 12px;
  color: #333;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 999px;
  line-height: 1;
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

</style>
</head>
<body>

<div style="max-width: 500px; margin: 20px auto 0; padding: 0 10px; font-size: 17px; font-weight: bold; color: #000000; text-align: center;">


<div id="daily-topic" ...>
  <span id="topic-text" class="sparkling-text">(ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦)</span>
</div>


<div class="chat-container" id="chatBox"></div>


<div class="input-container" style="flex-direction: column; gap: 10px;">
  <!-- ë“±ë¡ìš© -->
  <textarea id="chatInput"
    rows="1"
    placeholder="ë“±ë¡ í›„ ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€. ê³µì§€ ì–´ê¸´ ê¸€ì€ ë‹¬ì£¼ê°€ ë¬´í†µë³´ ì‚­ì œ."
    style="width: 100%; padding: 10px; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Malgun Gothic', sans-serif; box-sizing: border-box; resize: none; overflow: hidden;"></textarea>
  <button id="sendBtn" style="align-self: flex-end;">ë“±ë¡</button>

  <!-- âœï¸ ìˆ˜ì •ìš© ì…ë ¥ì°½ë„ ê°™ì´ ë„£ê¸° -->
  <textarea id="editInput"
    placeholder="ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
    rows="4"
    style="width: 100%; display: none; padding: 10px; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; font-family: 'Malgun Gothic', sans-serif; box-sizing: border-box; resize: none; overflow: hidden;"></textarea>
  <button id="editSubmitBtn"
    style="display: none; align-self: flex-end; padding: 10px 16px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;">ìˆ˜ì • ì™„ë£Œ</button>
</div>





<div id="topButtons" style="display:flex; justify-content:center; gap:8px;">
  <button id="infoBtn">â„¹ï¸ ì •ë³´ ë‹¬ê¸€ ì´ë™</button>
  <button id="adminBtn">ğŸ”’ ë‹¬ì£¼ ì „ìš©</button>
</div>


<div id="status-bar" style="display:flex; justify-content:center; gap:20px; font-size:13px; color:#555; margin-top:12px;">
  <div id="upload-count">ì˜¤ëŠ˜ì˜ ë‹µë³€ ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="visit-count">ë°©ë¬¸ì ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
  getFirestore,
  collection,
  getDocs,
  addDoc,
  deleteDoc,
  doc,
  getDoc,
  updateDoc,
  serverTimestamp,
  setDoc,
  query,
  where              // âœ… ì¶”ê°€
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
/* ===== ì˜¤ëŠ˜ì˜ ì£¼ì œ ìë™ ë³€ê²½ ===== */
/* ===== ì˜¤ëŠ˜ì˜ ì£¼ì œ ìë™ ë³€ê²½ ===== */
const TOPIC_LIST = [
  'ì•„ìŠ¤íŒ”íŠ¸ë¡œ ë‚˜ì™”ë˜ ë‚˜ë‚  ì¤‘, ë§ˆìŒì„ ê°€ì¥ í¬ê²Œ í”ë“  ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?',
  'í˜ë“¤ì—ˆì§€ë§Œ, ê·¸ë˜ë„ "ì´ê±´ ë‚´ê°€ ì§„ì§œ ìë‘ìŠ¤ëŸ¬ì› ë‹¤" ì‹¶ì—ˆë˜ ê¸°ì–µì´ ìˆì—ˆë‚˜ìš”?',
  'í•¨ê»˜ êµ¬í˜¸ë¥¼ ì™¸ì¹˜ë©´ì„œ ê°€ì¥ í¬ê²Œ ìš©ê¸°ë¥¼ ì–»ì—ˆë˜ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?',
  'ì¶”ìœ„ ì†ì—ì„œë„ "ì´ ê²ƒ ë•Œë¬¸ì— ë²„í‹¸ ìˆ˜ ìˆë‹¤."ëŠ” ëŠë‚Œì„ ì£¼ì—ˆë˜ ë¬´ì–¸ê°€ê°€ ìˆì—ˆë‚˜ìš”?',
  'ì§‘íšŒì—ì„œ ë§Œë‚œ ë¶„ë“¤ ì¤‘ì— ì•„ì§ë„ ë§ˆìŒì— ë‚¨ëŠ” ì–¼êµ´ì´ ìˆìœ¼ì‹ ê°€ìš”? (ì „ìƒ ë‹¬ê¸€ ì–¸ê¸‰ ìœ ì˜)',
  'ë‚˜ í˜¼ìê°€ ì•„ë‹ˆêµ¬ë‚˜" í•˜ê³  ëŠê¼ˆë˜ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?',
  'ë‘ë ¤ì›€ ì†ì—ì„œë„ ì›ƒìŒì´ í„°ì¡Œë˜, ì˜ˆìƒì¹˜ ëª»í•œ ìˆœê°„ì´ ìˆìœ¼ì…¨ë‚˜ìš”?',
  'í˜ë“¤ ë•Œ ë§ˆìŒì„ ì§€íƒ±í•´ ì¤€ ë…¸ë˜ë‚˜ êµ¬í˜¸ê°€ ìˆìœ¼ì…¨ë‚˜ìš”? ìˆì—ˆë‹¤ë©´ ì–´ëŠ ê°€ì‚¬/êµ¬í˜¸ì¸ê°€ìš”?',
  'ê³„ì—„ ì†Œì‹ì„ ì²˜ìŒ ë“¤ì—ˆì„ ë•Œ, ê°€ì¥ ë¨¼ì € ë– ì˜¤ë¥¸ ìƒê°ì€ ë­ì˜€ë‚˜ìš”?',
  'ì´ê±´ ê¼­ ê¸°ë¡í•´ë‘¬ì•¼ê² ë‹¤"ë¼ê³  ë§ˆìŒë¨¹ì—ˆë˜ ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?',
  'ê¹ƒë°œ/ì‘ì›ë´‰ ë“±ì„ ë¶™ì¡ê³  ì„°ì„ ë•Œ, ê°€ì¥ ë¨¼ì € í˜ë“¤ì—ˆë˜ ë¶€ë¶„ì€ ì–´ë””ì˜€ë‚˜ìš”?',
  'ê¸¸ì—ì„œ ë§Œë‚œ ë‚¯ì„  ì‚¬ëŒì´ í•´ì¤€ ë§ ì¤‘ ì•„ì§ë„ ê¸°ì–µë‚˜ëŠ” ê²Œ ìˆìœ¼ì‹ ê°€ìš”?',
  'ê°€ì¥ ë‘ë ¤ì› ë˜ ìˆœê°„, ì–´ë–»ê²Œ ë²„í‹°ì…¨ëŠ”ì§€ ë– ì˜¬ë ¤ ë³´ì‹¤ ìˆ˜ ìˆë‚˜ìš”?',
  'ì§‘íšŒ ëë‚˜ê³  ëŒì•„ì˜¤ëŠ” ê¸¸, í•˜ëŠ˜ì´ë‚˜ ë°”ëŒì´ ë‹¤ë¥´ê²Œ ëŠê»´ì§„ ì  ìˆìœ¼ì‹ ê°€ìš”?',
  'ëˆ„êµ°ê°€ì˜ ëˆˆë¬¼ì„ ë³´ë©´ì„œ ê°™ì´ ë§ˆìŒì´ ë¬´ë„ˆì¡Œë˜ ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?',
  'ì´ ì‹¸ì›€ì€ ë‚´ê°€ ì‚´ì•„ ìˆë‹¤ëŠ” ì¦ê±°ë‹¤"ë¼ê³  ëŠê¼ˆë˜ ë‚ ì€ ì–¸ì œì˜€ë‚˜ìš”?',
  'ìŠ¤ìŠ¤ë¡œì—ê²Œ í–ˆë˜ ë§ ì¤‘ì— ê°€ì¥ í˜ì´ ë˜ì—ˆë˜ ë§ì€ ë­ì˜€ë‚˜ìš”?',
  'í”¼ê³¤í•´ë„ ê³„ì† ë‚˜ì˜¤ê²Œ ë§Œë“  ì´ìœ , ì§€ê¸ˆ ìƒê°í•˜ë©´ ë­ì˜€ë˜ ê²ƒ ê°™ë‚˜ìš”?',
  'ë¬´ì„œì›Œì„œ ë°œê±¸ìŒì´ ë©ˆì¶œ ë»”í–ˆëŠ”ë°ë„ ê²°êµ­ ë‚˜ì„œê²Œ í•œ í˜ì€ ë­ì˜€ë‚˜ìš”?',
  'ê·¸ë•Œ ë°°ìš´ ì‘ì€ ìƒí™œ ì§€í˜œ(ì˜·, ìŒì‹, ì¶”ìœ„ë¥¼ ê²¬ë””ëŠ” ë°©ë²• ë“±) ì¤‘ì— ì§€ê¸ˆë„ ì“°ëŠ” ê²Œ ìˆìœ¼ì‹ ê°€ìš”? (ì „ìƒ ë‹¬ê¸€ ì–¸ê¸‰ ìœ ì˜)',
  'ë¶„ë…¸ ëŒ€ì‹  ì°¨ë¶„í•¨ì„ ì„ íƒí–ˆë˜ ìˆœê°„ì´ ìˆìœ¼ì…¨ë‚˜ìš”? ì–´ë–»ê²Œ í•˜ì…¨ë‚˜ìš”?',
  'ìˆ ìë¦¬ë‚˜ ë°¥ìë¦¬ì—ì„œ ì§‘íšŒ ì–˜ê¸°ë¥¼ êº¼ëƒˆì„ ë•Œ, ì˜ì™¸ë¡œ ê³µê°í•´ì¤€ ì‚¬ëŒì´ ìˆì—ˆë‚˜ìš”?',
  'ë‚´ê°€ ì‚´ì•„ ìˆë‹¤ëŠ” ê²ƒ ìì²´ê°€ ì¦ê±°ë‹¤"ë¼ê³  ëŠë‚€ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?',
  'ê°€ì¥ ëª¸ì´ í˜ë“¤ì—ˆëŠ”ë°ë„ ëê¹Œì§€ ë²„í‹´ í•˜ë£¨ëŠ” ì–¸ì œì˜€ë‚˜ìš”?',
  'ì§‘ì— ëŒì•„ì™€ í˜¼ì ëˆˆë¬¼ì„ í˜ë ¸ë˜ ê¸°ì–µì´ ìˆë‹¤ë©´, ì–´ë–¤ ìƒê° ë•Œë¬¸ì´ì—ˆë‚˜ìš”?',
  'ë¶ˆí™•ì‹¤í•œ ë‚´ì¼ ì†ì—ì„œë„ "ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” ê±´ ìˆë‹¤"ë¼ê³  ë‹¤ì§í–ˆë˜ ê±´ ë­ì˜€ë‚˜ìš”?',
  'ëˆ„êµ°ê°€ ê±´ë„¨ ë”°ëœ»í•œ ìŒì‹ì´ë‚˜ ë¬¼ í•œ ë³‘ì´ ìœ ë‚œíˆ ê³ ë§ˆì› ë˜ ë‚  ê¸°ì–µë‚˜ì‹œë‚˜ìš”?',
  'SNSë‚˜ ë©”ì‹œì§€ë¡œ ë°›ì€ ì‘ì› ì¤‘ì— ì§€ê¸ˆë„ ê¸°ì–µë‚˜ëŠ” ë§ì”€ì´ ìˆìœ¼ì‹ ê°€ìš”?',
  'ìš°ë¦¬ëŠ” ì´ê²¼ë‹¤"ë¼ê³  ëŠë‚€ ì‘ì€ ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?',
  'ì§€ê¸ˆ ëŒì•„ë³´ë©´, ê·¸ë•Œì˜ ë‚˜ì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ í•œë§ˆë””ê°€ ìˆì„ê¹Œìš”?',
  'ë¶ˆë²• ê³„ì—„ ì´ì „/ì´í›„ ë‚˜ì˜ ê°€ì¥ ë‹¬ë¼ì§„ ëª¨ìŠµì€ ë¬´ì—‡ì¼ê¹Œìš”?',
  'ìµœê·¼ ë³´ì‹  ë‰´ìŠ¤/ì˜ìƒ ì¤‘ì—ì„œ ê°€ì¥ "í¬ë§ì "ì´ë¼ê³  ëŠë¼ì‹  ì¥ë©´ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ê³¼ê±°ë¥¼ ëŒì•„ë³¼ ë•Œ, ìš°ë¦¬ê°€ í•¨ê»˜ ì´ê²¨ë‚¸ ìˆœê°„ ì¤‘ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ê±´ ì–¸ì œì¸ê°€ìš”?',
  'ì˜¤ëŠ˜ì˜ ì‹œì‚¬ ì£¼ì œì—ì„œ "ì•ìœ¼ë¡œ ë” ë‚˜ì•„ì§ˆ ìˆ˜ ìˆê² ë‹¤"ëŠ” ê°€ëŠ¥ì„±ì„ ëŠë¼ì‹  ë¶€ë¶„ì€ ì–´ë””ì˜€ë‚˜ìš”?',
  'ìµœê·¼ ì •ì¹˜Â·ì‚¬íšŒ ë³€í™” ì†ì—ì„œ ê°œì¸ì ìœ¼ë¡œ ê°€ì¥ í˜ì´ ë˜ì—ˆë˜ ê¸°ì–µì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ì˜ìƒì„ ë³´ë©´ì„œ "ì´ëŸ° ë…¸ë ¥ì€ ë‚´ê°€ ì§ì ‘ í•´ë³´ê³  ì‹¶ë‹¤"ê³  ëŠë¼ì‹  ê²Œ ìˆìœ¼ì…¨ë‚˜ìš”?',
  'ë‰´ìŠ¤ ì† ì¥ë©´ ì¤‘, í•¨ê»˜í•´ì„œ ë” ê°•í•´ì§„ ê²½í—˜ì„ ë– ì˜¬ë¦¬ê²Œ í•œ ê±´ ì–´ë–¤ ë¶€ë¶„ì´ì—ˆë‚˜ìš”?',
  'ì´ê±´ ìš°ë¦¬ ì„¸ëŒ€ê°€ ë°˜ë“œì‹œ í•´ë‚´ì•¼ í•œë‹¤"ëŠ” ìƒê°ì´ ë“¤ì—ˆë˜ ë¶€ë¶„ì´ ìˆì„ê¹Œìš”?',
  'ì•ìœ¼ë¡œ ë” ë‚˜ì€ ì‚¬íšŒë¥¼ ìœ„í•´ ë‚´ê°€ ì‘ê²Œë¼ë„ ì‹¤ì²œí•  ìˆ˜ ìˆëŠ” ê±´ ë¬´ì—‡ì¼ê¹Œìš”?',
  'ìµœê·¼ ì‹œì‚¬ ì´ìŠˆì—ì„œ ê°€ì¥ "ê¸ì •ì ì¸ ë³€í™”ì˜ ì”¨ì•—"ì´ë¼ê³  ëŠë¼ì‹  ê±´ ë¬´ì—‡ì¸ê°€ìš”?',
  'ì§€ë‚œ ì§‘íšŒÂ·í† ë¡ Â·í˜„ì¥ ê²½í—˜ ì¤‘ì—ì„œ ì§€ê¸ˆ ë– ì˜¬ë¦¬ë©´ ìš©ê¸°ê°€ ë‚˜ëŠ” ìˆœê°„ì€ ì–¸ì œì¸ê°€ìš”?',
  'ì˜ìƒì„ ë³´ë©° "ì´ê±´ ìš°ë¦¬ê°€ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•œë‹¤"ê³  ë‹¤ì§í•œ ê°€ì¹˜ê°€ ìˆìœ¼ì‹ ê°€ìš”?',
  'ì˜¤ëŠ˜ ì£¼ì œì—ì„œ "ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” ëª«"ì„ ë‹¤ì‹œ ìƒê°í•˜ê²Œ ëœ ë¶€ë¶„ì€ ì–´ë””ì˜€ë‚˜ìš”?',
  'ì •ì¹˜Â·ì‚¬íšŒ í˜„ì•ˆ ì†ì—ì„œ "ì‘ì€ ëª©ì†Œë¦¬ë¼ë„ í˜ì´ ëœë‹¤"ëŠ” ê±¸ ëŠë¼ì‹  ê²½í—˜ì´ ìˆìœ¼ì‹ ê°€ìš”?',
  'ë‹¤íë‚˜ ë‰´ìŠ¤ë¥¼ ë³´ë©° "ê·¸ë˜ë„ ë³€í™”ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤"ëŠ” í¬ë§ì„ ì–»ì€ ë¶€ë¶„ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ì˜ˆì „ì— í˜ë“¤ì—ˆì§€ë§Œ, ê²°êµ­ ìš°ë¦¬ê°€ ì´ê²¨ëƒˆë‹¤ê³  ëŠê¼ˆë˜ ê¸°ì–µì€ ì–´ë–¤ ê±´ê°€ìš”?',
  'ì˜ìƒì„ ë³´ë©´ì„œ "ì§€ê¸ˆë³´ë‹¤ ë” ë‚˜ì€ ë‚´ì¼"ì„ ìƒìƒí•˜ê²Œ ë§Œë“  ë¶€ë¶„ì€ ì–´ë””ì˜€ë‚˜ìš”?',
  'ì˜¤ëŠ˜ ë‹¤ë£¬ ì£¼ì œ ì¤‘ "ë‹¤ìŒ ì„¸ëŒ€ì—ê²Œ ê¼­ ë¬¼ë ¤ì£¼ê³  ì‹¶ì€ ê°€ì¹˜"ëŠ” ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ìš°ë¦¬ê°€ í•¨ê»˜ ëª©ì†Œë¦¬ë¥¼ ë‚¼ ë•Œ, ì„¸ìƒì´ ë°”ë€ ê²½í—˜ì„ ë– ì˜¬ë¦¬ì‹  ì  ìˆìœ¼ì‹ ê°€ìš”?',
  'ì´ë²ˆ ì´ìŠˆë¥¼ ë³´ë©° "ë‚˜ëŠ” ì ˆëŒ€ í¬ê¸°í•˜ì§€ ì•Šê² ë‹¤"ëŠ” ìƒê°ì„ êµ³íˆì‹  ë¶€ë¶„ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ì •ì¹˜Â·ì‚¬íšŒ íë¦„ ì†ì—ì„œ "ë‚´ê°€ ì´ ê¸¸ì„ ê³„ì† ê°€ì•¼ í•œë‹¤"ê³  ë‹¤ì§í•˜ê²Œ ëœ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?',
  'ë‰´ìŠ¤ ì†ì—ì„œ ë³´ì‹  ì¸ë¬¼ ì¤‘ "ì´ëŸ° ìì„¸ëŠ” ë³¸ë°›ê³  ì‹¶ë‹¤"ê³  ëŠë¼ì‹  ë¶„ì´ ìˆìœ¼ì‹ ê°€ìš”?',
  'ì˜ìƒì„ ë³´ë©° "ê·¸ë˜, ê²°êµ­ ì—­ì‚¬ëŠ” ì•ìœ¼ë¡œ ë‚˜ì•„ê°„ë‹¤"ê³  í™•ì‹ í•˜ê²Œ ëœ ì´ìœ ëŠ” ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ì˜¤ëŠ˜ ì£¼ì œ ì¤‘ "ìš°ë¦¬ê°€ í•¨ê»˜ë¼ì„œ ê°€ëŠ¥í•˜ë‹¤"ê³  ëŠë‚€ ë¶€ë¶„ì€ ì–´ë””ì˜€ë‚˜ìš”?',
  'ì˜ˆì „ì˜ ì ˆë§ì ì¸ ìˆœê°„ì„ ëŒì´ì¼œë³´ë©´, "ê·¸ë•Œ ë‚´ê°€ ë²„í…¨ì„œ ë‹¤í–‰ì´ë‹¤" ì‹¶ì€ ê²½í—˜ì€ ë¬´ì—‡ì¸ê°€ìš”?',
  'ì´ë²ˆ ì£¼ì œì—ì„œ "ì•ìœ¼ë¡œì˜ ë‚˜"ì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ë‹¤ì§ì€ ì–´ë–¤ ê±´ê°€ìš”?',
  'ì˜ìƒì„ ë³´ë©° ë– ì˜¤ë¥¸ "ë‚´ê°€ ì§€í‚¤ê³  ì‹¶ì€ í•œêµ­ ì‚¬íšŒì˜ ëª¨ìŠµ"ì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ë‰´ìŠ¤ ì†ì—ì„œ ë°œê²¬í•œ "ì‘ì€ í¬ë§ì˜ ì§•í›„"ëŠ” ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ì˜¤ëŠ˜ ì£¼ì œì—ì„œ ëŠë‚€ "ìš°ë¦¬ëŠ” ë°˜ë“œì‹œ í•´ë‚¼ ìˆ˜ ìˆë‹¤"ëŠ” í™•ì‹ ì˜ ê·¼ê±°ëŠ” ë¬´ì—‡ì´ì—ˆë‚˜ìš”?',
  'ì§€ê¸ˆ ëŒì•„ë³´ë©´, "ì•ìœ¼ë¡œì˜ ê¸¸ì—ì„œ ë‚˜ ìì‹ ì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ê²©ë ¤ì˜ ë§"ì€ ë¬´ì—‡ì¸ê°€ìš”?'
];


// ë°©ë¬¸ ì¤‘ ê³ ì • ëœë¤ í† í”½ ì„ íƒ
function getSessionTopic() {
  const key = "session_topic";
  const saved = sessionStorage.getItem(key);
  if (saved) return saved;
  
  const i = Math.floor(Math.random() * TOPIC_LIST.length);
  const newTopic = TOPIC_LIST[i];
  sessionStorage.setItem(key, newTopic);
  return newTopic;
}

// ì„ íƒëœ í† í”½ì„ í™”ë©´ì— ë Œë”ë§
function renderTodayTopic() {
  const el = document.getElementById("topic-text");
  if (!el) return;
  el.textContent = getSessionTopic();
}

renderTodayTopic();


const firebaseConfig = {
  apiKey: "AIzaSyAZHqkGXdH4XxL-0jprA2DB7YO4XhTdNmQ",
  authDomain: "chat-page-6d547.firebaseapp.com",
  projectId: "chat-page-6d547",
  storageBucket: "chat-page-6d547.appspot.com",
  messagingSenderId: "1087235341754",
  appId: "1:1087235341754:web:6583340a62f21068b5b183"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let isAdmin = false;
let editingId = null;

const pastelColors = ['#fff5f7', '#fffdea', '#f0fbff', '#f0fff4', '#f7f3ff', '#fffaf0', '#fef4fb'];





document.getElementById("sendBtn").onclick = async () => {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;

  // â–¼ í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ìƒë‹¨ ì§ˆë¬¸ í…ìŠ¤íŠ¸
  const topicText = (document.getElementById("topic-text")?.textContent || "").trim();

  const counterRef = doc(db, "meta", "nicknameCounter");
  const counterSnap = await getDoc(counterRef);
  let nickname = "ìµëª… ?";
  if (counterSnap.exists()) {
    const count = counterSnap.data().count || 1;
    nickname = `ìµëª… ${count}`;
    await updateDoc(counterRef, { count: count + 1 });
  }

  await addDoc(collection(db, "chat"), {
    text,
    question: topicText,  // â† ì§ˆë¬¸ í•¨ê»˜ ì €ì¥
    timestamp: serverTimestamp(),
    likes: 0,
    nickname
  });

  input.value = "";
  loadChat();
};




document.getElementById("editSubmitBtn").onclick = async () => {
  const text = document.getElementById("editInput").value.trim();
  if (!text || !editingId) return;
  const ref = doc(db, "chat", editingId);
  await updateDoc(ref, { text });
  editingId = null;
  document.getElementById("editInput").style.display = "none";
  document.getElementById("editSubmitBtn").style.display = "none";
  document.getElementById("editInput").value = "";
  loadChat();
};





async function loadChat() {
  const box = document.getElementById("chatBox");
  box.innerHTML = "";
  const snapshot = await getDocs(collection(db, "chat"));
  let lastColorIndex = -1;

  const chats = [];
  snapshot.forEach(docSnap => {
    chats.push({ id: docSnap.id, ...docSnap.data() });
  });

  chats.sort((a, b) => {
    if (a.pinned && !b.pinned) return -1;
    if (!a.pinned && b.pinned) return 1;
    return (a.timestamp?.seconds || 0) - (b.timestamp?.seconds || 0);
  });

  for (const data of chats) {
    const id = data.id;
    const key = `liked_${id}`;
    const liked = localStorage.getItem(key) === "true";

    let colorIndex;
    do {
      colorIndex = Math.floor(Math.random() * pastelColors.length);
    } while (colorIndex === lastColorIndex);
    lastColorIndex = colorIndex;
    const cardColor = pastelColors[colorIndex];

    const div = document.createElement("div");
    div.className = "chat-card";
    if (data.pinned === true) div.classList.add("pinned-card");
    div.style.backgroundColor = cardColor;

    // ğŸ”’ ê´€ë¦¬ì ë²„íŠ¼ ì˜ì—­
    if (isAdmin) {
      const adminControls = document.createElement("div");
      adminControls.style.display = "flex";
      adminControls.style.justifyContent = "flex-end";
      adminControls.style.gap = "6px";
      adminControls.style.marginBottom = "8px";

      const pinBtn = document.createElement("button");
      pinBtn.className = "admin-button";
      pinBtn.textContent = data.pinned ? "ê³ ì • í•´ì œ" : "ê³ ì •";
      pinBtn.onclick = () => togglePin(id, !!data.pinned);

      const editBtn = document.createElement("button");
      editBtn.className = "admin-button";
      editBtn.textContent = "ìˆ˜ì •";
      editBtn.onclick = () => editChat(id, data.text.replace(/`/g, "\\`"));

      const delBtn = document.createElement("button");
      delBtn.className = "admin-button";
      delBtn.textContent = "ì‚­ì œ";
      delBtn.onclick = () => deleteChat(id);

      adminControls.appendChild(pinBtn);
      adminControls.appendChild(editBtn);
      adminControls.appendChild(delBtn);
      div.appendChild(adminControls);
    }





    // ë‹‰ë„¤ì„/ê³ ì • ë§ˆí¬
    const header = document.createElement("div");
    header.innerHTML = `<strong>${data.pinned ? "ğŸ“Œ" : (data.nickname || "ìµëª…")}</strong>`;
    div.appendChild(header);
// â–¼ ì§ˆë¬¸ ë°°ì§€


// â–¼ ì§ˆë¬¸ ë°°ì§€ (ê³ ì •ê¸€ì—ëŠ” í‘œì‹œ ì•ˆ í•¨)
if (!data.pinned) {
  const q = document.createElement("div");
  q.className = "question-chip";
  const qText = (data.question && String(data.question).trim()) || "ì§ˆë¬¸ ë¯¸ê¸°ë¡";
  q.textContent = `Q. ${qText}`;
  div.appendChild(q);
}




    // ë³¸ë¬¸ ì˜ì—­ (ë”ë³´ê¸°/ì¤„ì´ê¸° í¬í•¨)
    const textDiv = document.createElement("div");




    textDiv.className = "chat-text preview";
    textDiv.innerHTML = (data.text || "")
      .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
      .replace(/~~(.+?)~~/g, '<span style="font-size: 12px; color: #888;">$1</span>')
      .replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank">$1</a>')
      .replace(/\n/g, "<br>");

    const toggle = document.createElement("div");
    toggle.className = "toggle-more";
    toggle.textContent = "ë”ë³´ê¸°";
    toggle.addEventListener("click", (e) => {
      e.stopPropagation();
      textDiv.classList.toggle("expanded");
      textDiv.classList.toggle("preview");
      toggle.textContent = textDiv.classList.contains("expanded") ? "ì¤„ì´ê¸°" : "ë”ë³´ê¸°";
    });

    div.appendChild(textDiv);

    requestAnimationFrame(() => {
      if (textDiv.scrollHeight > textDiv.clientHeight + 4) {
        div.appendChild(toggle);
      }
    });

    // í•˜ë‹¨ ì¢‹ì•„ìš”/ì‹œê°„ í‘œì‹œ
    const footer = document.createElement("div");
    footer.className = "card-footer";
    footer.innerHTML = `
      <div style="display: flex; align-items: center; gap: 4px;">
        <button class="like-button ${liked ? "liked" : ""}" onclick="likeChat('${id}', this)">
          ${liked ? "ğŸ’™" : "â™¡"}
        </button>
        <span class="like-count">${data.likes || 0}</span>
      </div>
      <div class="timestamp">${data.timestamp?.toDate ? new Date(data.timestamp.toDate()).toLocaleString("ko-KR", {
        year: "numeric", month: "2-digit", day: "2-digit",
        hour: "2-digit", minute: "2-digit"
      }) : ""}</div>
    `;

    div.appendChild(footer);
    box.appendChild(div);
  }

  box.scrollTop = box.scrollHeight;
}







window.deleteChat = async function(id) {
  const ok = confirm("ì‚­ì œí• ê¹Œìš”?");
  if (!ok) return;
  await deleteDoc(doc(db, "chat", id));
  loadChat();
};
window.togglePin = async function(id, currentlyPinned) {
  const ref = doc(db, "chat", id);
  await updateDoc(ref, { pinned: !currentlyPinned });
  loadChat();
};

window.likeChat = async function(id, btn) {
  const key = `liked_${id}`;
  const ref = doc(db, "chat", id);
  const snap = await getDoc(ref);
  if (!snap.exists()) return;
  const data = snap.data();
  const countSpan = btn.nextElementSibling;
  let currentLikes = data.likes || 0;

  const liked = localStorage.getItem(key) === "true";
  if (liked) {
    await updateDoc(ref, { likes: currentLikes - 1 });


    localStorage.setItem(key, "false");
    btn.classList.remove("liked");
    btn.innerHTML = "â™¡";
    countSpan.textContent = currentLikes - 1;
  } else {
    await updateDoc(ref, { likes: currentLikes + 1 });

    btn.classList.add("liked");
    btn.innerHTML = "ğŸ’™";
    countSpan.textContent = currentLikes + 1;
  }
};
window.editChat = function(id, currentText) {
  const editBox = document.getElementById("editInput");
  const editBtn = document.getElementById("editSubmitBtn");
  editingId = id;
  editBox.value = currentText;
  editBox.style.display = "block";
  editBtn.style.display = "inline-block";
};


document.getElementById("infoBtn").onclick = () => {
  window.location.href = "https://www.yssisa.store";
};

document.getElementById("adminBtn").onclick = async () => {
  const pwd = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
  if (!pwd) return;
  const snap = await getDoc(doc(db, "admin", "secret"));
  if (!snap.exists()) return alert("ë¹„ë°€ë²ˆí˜¸ ë°ì´í„° ì—†ìŒ");
  const real = snap.data().password;
  if (pwd === real) {
    isAdmin = true;
    loadChat();
    alert("ê´€ë¦¬ì ê¶Œí•œì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
  } else {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
  }
};

loadChat();
const chatInput = document.getElementById("chatInput");

chatInput.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});
const editInput = document.getElementById("editInput");
editInput.addEventListener("input", function () {
  this.style.height = "auto";
  this.style.height = this.scrollHeight + "px";
});








function getKSTDateKey() {
  const now = new Date();
  const kstOffset = 9 * 60 * 60 * 1000;
  const kstNow = new Date(now.getTime() + kstOffset);
  return kstNow.toISOString().split('T')[0];
}

async function countVisitor() {
  const dateKey = getKSTDateKey();
  const pageKey = dateKey + "_event"; // âœ… í˜ì´ì§€ êµ¬ë¶„ ì¶”ê°€
  const visited = localStorage.getItem('visited_' + pageKey);
  if (visited) {
    getVisitorCount(pageKey);
    return;
  }

  const counterRef = doc(db, "visit_count", pageKey);  // âœ… ë¬¸ì„œ IDì— _event
  const snap = await getDoc(counterRef);
  if (snap.exists()) {
    const current = snap.data().total || 0;
    await setDoc(counterRef, { total: current + 1 });
    displayVisitorCount(current + 1);
  } else {
    await setDoc(counterRef, { total: 1 });
    displayVisitorCount(1);
  }







 localStorage.setItem('visited_' + pageKey, 'true');
}

async function getVisitorCount(todayKey) {
  const counterRef = doc(db, "visit_count", todayKey);
  const snap = await getDoc(counterRef);
  if (snap.exists()) {
    const current = snap.data().total || 0;
    displayVisitorCount(current);
  } else {
    displayVisitorCount(0);
  }
}

function displayVisitorCount(count) {
  const visitDiv = document.getElementById("visit-count");
  if (visitDiv) {
    visitDiv.textContent = `ì˜¤ëŠ˜ ë°©ë¬¸ì ìˆ˜: ${count.toLocaleString()}ëª…`;
  }
}


async function countTodayUploadRequests() {
  const todayKey = getKSTDateKey();
  const start = new Date(`${todayKey}T00:00:00+09:00`);
  const end = new Date(`${todayKey}T23:59:59+09:00`);

  // chat ì»¬ë ‰ì…˜ì—ì„œ ì˜¤ëŠ˜ ê¸€ë§Œ ì¡°íšŒ
  const q = query(
    collection(db, "chat"),
    where("timestamp", ">=", start),
    where("timestamp", "<=", end)
  );

  const snapshot = await getDocs(q);
  const count = snapshot.size;

  const countDiv = document.getElementById("upload-count");
  if (countDiv) {
    countDiv.textContent = `ì˜¤ëŠ˜ ì±„íŒ… ìˆ˜: ${count.toLocaleString()}ê±´`;
  }
}



countVisitor();
countTodayUploadRequests();




</script>
</body>
</html>
