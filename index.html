
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>[여성시대] 뉴스 시사 라이브 달글 부속</title>
<style>
    body {
      font-family: "Malgun Gothic", sans-serif;
      background-color: #f2f5f8;
      margin: 0;
      padding: 0;
      font-size: 14px;
    }
    .page-title {
      max-width: 700px;
      margin: 30px auto 20px;
      text-align: center;
      padding: 0 15px;
      line-height: 1.6;
    }
    .page-title .main-title {
      font-size: 21px;
      font-weight: bold;
    }
    .page-title .sub-title {
      font-size: 13px;
      font-weight: normal;
    }
    .chat-container {
  width: 500px;
  height: 600px;
  overflow-y: auto;
  margin: 0 auto;
  padding: 10px;
  background-color: #e0f3ff;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}
    .chat-bubble {
      max-width: 80%;
      padding: 10px 14px;
      margin: 10px auto;
      border-radius: 18px;
      font-size: 14px;
      line-height: 1.5;
      word-wrap: break-word;
      background-color: #ffffff;
      border: 1px solid #dcdcdc;
      position: relative;
      user-select: none;
      cursor: pointer;
    }
    .timestamp {
      font-size: 12px;
      color: #888;
      text-align: right;
      margin-top: 4px;
    }
    .bubble-buttons {
      display: none;
      font-size: 12px;
      margin-top: 6px;
      text-align: right;
    }
    .search-bar, #input-area, #admin-panel {
      max-width: 500px;
      margin: 20px auto;
      text-align: center;
    }
    .search-bar input {
  width: 100%;
  max-width: 333px;
  margin: 0 auto;
  display: block;
  padding: 8px 12px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 8px;
}
    button {
      margin-top: 10px;
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 8px;
      border: none;
      background-color: #aaa;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #888;
    }
    #toast {
      display: none;
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: #fff;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 14px;
      opacity: 0.9;
      z-index: 1000;
    }
    .chat-content.preview .inner-text {
      max-height: 4.5em;
      overflow: hidden;
    }
    .chat-content.expanded .inner-text {
      max-height: none;
    }
    .chat-content .inner-text {
      transition: max-height 0.3s ease;
    }
</style>
</head>
<body>
<div class="page-title">
<div class="main-title">뉴스 시사 라이브 달글 부속</div><br/>
<div class="sub-title">댓관용 날조 정정 자료</div>
<div class="sub-title">박찬대 당대표 후보 밭갈이용 정보 모음 💙<br/><br/></div>
<div class="sub-title"><span style="font-size: 12px; color: #777;">💡 → 날조 사실에 대한 팩트 정리</span></div>
<div class="sub-title"><span style="font-size: 12px; color: #777;">🔵 → 박찬대 당대표 후보 밭갈이용</span></div>
<div class="sub-title"><span style="font-size: 12px; color: #777;">🔔 → 참고하면 좋은 정보</span></div><div class="search-bar">
<input id="searchInput" oninput="filterMessages()" placeholder="검색" type="text"/>
</div>
</div>
<div class="chat-container" id="chatBox"></div>
<div id="admin-panel">
<button onclick="showPasswordPrompt()">🔒 달주 전용</button>
</div>
<div id="input-area" style="display:none;">
<textarea id="newMessage" placeholder="내용" rows="3"></textarea>
<br/>
<button onclick="addOrUpdateMessage()">내용 추가</button>
</div>
<div id="toast">📋 복사</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore, collection, getDocs, addDoc, deleteDoc, updateDoc,
  doc, serverTimestamp, query, orderBy
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAZHqkGXdH4XxL-0jprA2DB7YO4XhTdNmQ",
  authDomain: "chat-page-6d547.firebaseapp.com",
  projectId: "chat-page-6d547",
  storageBucket: "chat-page-6d547.appspot.com",
  messagingSenderId: "1087235341754",
  appId: "1:1087235341754:web:6583340a62f21068b5b183"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let isAdmin = false;
let editingId = null;

async function loadMessages() {
  const container = document.getElementById("chatBox");
  container.innerHTML = "";
  const q = query(collection(db, "message"), orderBy("timestamp", "asc"));
  const snapshot = await getDocs(q);
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const id = docSnap.id;
    const msg = data.content;
    const ts = data.timestamp ? data.timestamp.toDate() : new Date();
    const dateOnly = ts.getFullYear() + '-' + String(ts.getMonth()+1).padStart(2, '0') + '-' + String(ts.getDate()).padStart(2, '0');

    const bubble = document.createElement("div");
    bubble.className = "chat-bubble";
    bubble.innerHTML = `
      <div class="chat-content preview">
        <div class="inner-text">${msg.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>').replace(/\n/g, '<br>')}</div>
        <div class="toggle-more" style="text-align:right; font-size:12px; color:gray; cursor:pointer;">더보기</div>
      </div>
      <div class="timestamp">${dateOnly}</div>
    `;

    const toggle = bubble.querySelector('.toggle-more');
    const content = bubble.querySelector('.chat-content');
    toggle.addEventListener('click', (event) => {
      event.stopPropagation();
      content.classList.toggle('expanded');
      toggle.textContent = content.classList.contains('expanded') ? '줄임' : '더보기';
    });

    bubble.addEventListener("click", () => {
      navigator.clipboard.writeText(msg).then(() => {
        const toast = document.getElementById("toast");
        toast.style.display = "block";
        setTimeout(() => toast.style.display = "none", 1500);
      });
    });

    if (isAdmin) {
      const btns = document.createElement("div");
      btns.className = "bubble-buttons";
      btns.style.display = "block";
      const editBtn = document.createElement("button");
      editBtn.textContent = "수정";
      editBtn.onclick = () => {
        document.getElementById("newMessage").value = msg;
        editingId = id;
      };
      const delBtn = document.createElement("button");
      delBtn.textContent = "삭제";
      delBtn.onclick = async () => {
        await deleteDoc(doc(db, "message", id));
        loadMessages();
      };
      btns.appendChild(editBtn);
      btns.appendChild(delBtn);
      bubble.appendChild(btns);
    }

    container.appendChild(bubble);
  });
}

async function addOrUpdateMessage() {
  const content = document.getElementById("newMessage").value.trim();
  if (!content) return;
  if (editingId) {
    await updateDoc(doc(db, "message", editingId), { content });
    editingId = null;
  } else {
    await addDoc(collection(db, "message"), {
      content,
      timestamp: serverTimestamp()
    });
  }
  document.getElementById("newMessage").value = "";
  loadMessages();
}

function showPasswordPrompt() {
  const pwd = prompt("비밀번호를 입력하세요");
  if (pwd === "980324") {
    isAdmin = true;
    document.getElementById("input-area").style.display = "block";
    loadMessages();
  } else {
    alert("비밀번호가 틀렸습니다.");
  }
}

function filterMessages() {
  const queryText = document.getElementById("searchInput").value.toLowerCase();
  const bubbles = document.querySelectorAll(".chat-bubble");
  bubbles.forEach(b => {
    const text = b.textContent.toLowerCase();
    b.style.display = text.includes(queryText) ? "block" : "none";
  });
}

window.addOrUpdateMessage = addOrUpdateMessage;
window.showPasswordPrompt = showPasswordPrompt;
window.filterMessages = filterMessages;
window.onload = loadMessages;
</script>
</body>
</html>
